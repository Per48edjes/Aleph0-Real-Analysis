\section{Derivatives}

\begin{callout}
  We take the following theorem to be given (as the proof has been
  \href{https://youtu.be/Av210fDPukY}{provided}).
  \begin{theorem}[Product Rule for Derivatives]
  \label{thm:prod-rule-deriv}
    Let $f$ and $g$ be differentiable functions. Then the product $f \cdot g$ is differentiable, and
    \[
      (f \cdot g)'(x) = f'(x) \cdot g(x) + f(x) \cdot g'(x).
    \]
  \end{theorem}

\end{callout}

\begin{problem}
  Using the definition of the derivative, compute $f'(x)$ for $f(x) = 3x + 5$.
  \vspace{\baselineskip}

  By the definition of the derivative:
    \begin{align*}
    f'(x) &= \lim_{h \to 0}\frac{f(x+h)-f(x)}{h}\\
          &= \lim_{h \to 0}\frac{3(x+h)+5-(3x+5)}{h}\\
          &= \lim_{h \to 0}\frac{3x+3h+5-3x-5}{h}\\
          &= \lim_{h \to 0}\frac{3h}{h}\\
          &= \lim_{h \to 0}3\\
          &= 3.
    \end{align*}
\end{problem}

\begin{problem}
  Find the derivative of $f(x) = x^{4} - 2x^{3} + 7x - 1$.
  \vspace{\baselineskip}

  By the definition of the derivative, we have
    \begin{align*}
      f'(x) &= \lim_{h \to 0}\frac{f(x+h)-f(x)}{h}\\
            &= \lim_{h \to 0}\frac{(x+h)^4-2(x+h)^3+7(x+h)-1 - (x^4-2x^3+7x-1)}{h}. \\
    \end{align*}
  Expanding, using the binomial theorem, the higher degree terms produces
  \[
    (x+h)^4 = x^4 + 4x^3h + 6x^2h^2 + 4xh^3 + h^4, \quad
    (x+h)^3 = x^3 + 3x^2h + 3xh^2 + h^3.
  \]
  Substituting, simplifying, and evaluating the limit gives us the desired result:
  \[
    f'(x) = 4x^3 - 6x^2 + 7.
  \]
\end{problem}

\begin{problem}
  Compute $\deriv{}{x} \left( \dfrac{1}{x^{2}} \right)$.
  \vspace{\baselineskip}

  Let $f(x) = \left( \dfrac{1}{x^{2}} \right)$. Using the definition of the derivative:
    \begin{align*}
      f'(x) &= \lim_{h \to 0}\frac{\frac{1}{(x+h)^2} - \frac{1}{x^2}}{h}\\
            &= \lim_{h \to 0}\frac{x^2 - (x+h)^2}{h(x+h)^2x^2}\\
            &= \lim_{h \to 0}\frac{x^2 - (x^2 + 2xh + h^2)}{h(x+h)^2x^2}\\
            &= \lim_{h \to 0}\frac{-2xh - h^2}{h(x+h)^2x^2}\\
            &= \lim_{h \to 0}\frac{-2x - h}{(x+h)^2x^2}\\
            &= -\frac{2}{x^3}.
    \end{align*}
\end{problem}

\begin{problem}
  \label{prob:derivative-constant}
  Using the definition of the derivative, show that if $f(x) = c$ (a constant), then $f'(0) = 0$.
  \vspace{\baselineskip}

  By the definition of the derivative:
    \begin{align*}
      f'(x) &= \lim_{h \to 0}\frac{f(x+h)-f(x)}{h}\\
            &= \lim_{h \to 0}\frac{c-c}{h} = \lim_{h \to 0}\frac{0}{h}\\
            &= 0.
    \end{align*}
\end{problem}

\begin{problem}
  Use the product rule to find the derivative of $f(x) = (x^{2} + 1)(x^{3} - 2x)$.
  \vspace{\baselineskip}

  Let $u(x) = x^2 + 1$ and $v(x) = x^3 - 2x$. First, we compute the derivatives:
  \[
    u'(x) = 2x, \quad v'(x) = 3x^2 - 2.
  \]
  Next, we substitute into \thmref{thm:prod-rule-deriv}:
    \begin{align*}
    f'(x) &= u'(x)v(x) + u(x)v'(x)\\
          &= 2x(x^3 - 2x) + (x^2 + 1)(3x^2 - 2)\\
          &= 2x^4 - 4x^2 + 3x^4 + 3x^2 - 2x^2 - 2\\
          &= 5x^4 - 3x^2 - 2.
    \end{align*}
\end{problem}

\begin{problem}
  Compute the derivative of $f(x) = \sqrt{x}$ at $x = 9$ using the definition of the derivative.
  \vspace{\baselineskip}

  Let $f(x) = \sqrt{x}$. Then, by the definition of the derivative:
    \begin{align*}
      f'(x) &= \lim_{h \to 0}\frac{\sqrt{x+h} - \sqrt{x}}{h}\\
            &= \lim_{h \to 0}\frac{(\sqrt{x+h} - \sqrt{x})(\sqrt{x+h} + \sqrt{x})}{h(\sqrt{x+h} - \sqrt{x})}\\
            &= \lim_{h \to 0}\frac{(x + h) - x}{h(\sqrt{x+h} - \sqrt{x})}\\
            &= \frac{1}{2 \sqrt{x}}.
    \end{align*}
\end{problem}

\begin{problem}
  \label{prob:derivative-power-rule-positive-integers}
  If $f(x) = x^{n}$ where $n$ is a positive integer, prove (using the definition of the derivative) that 
  $f'(x) = nx^{n-1}$.

  \begin{proof}
    By the definition of the limit and the binomial theorem, we have:
    \begin{align*}
       \deriv{}{x} x^n = \lim_{h \to 0} \frac{(x + h)^{n} - x^{n}}{h} &= \lim_{h \to \infty} \frac{\sum_{k=0}^{n}\binom{n}{k}x^{k}h^{n-k}}{h}\\
                                                     &= \lim_{h \to \infty} \sum_{k=0}^{n-1}\binom{n}{k}x^{k}h^{n-k-1}\\
                                                     &= nx^{n-1}.
    \end{align*}
  \end{proof}
\end{problem}

\begin{problem}
  Consider the function
    \begin{equation*}
      f(x) = 
      \begin{cases}
        x^2 \sin(1/x) & \text{if } x \neq 0 \\
        0 & \text{if } x = 0
      \end{cases}
    \end{equation*}
  Show that $f$ is differentiable at $x = 0$, but $f'$ is not continuous at $x = 0$.

  \begin{proof}
    We will first determine how $f'$ is defined. As a consequence of this definition, we will be able to establish
    that $f'(0)$ is well-defined. We then will demonstrate that $f'$ is not continuous.
    (Before we proceed, we will prove the analogue of \thmref{thm:squeeze-theorem-sequences} for 
    functional limits.)

    \begin{theorem}[Squeeze Theorem for Functional Limits]
      \label{thm:squeeze-theorem-fn-limits}
      Let $f, g, h$ satisfy $f(x) \leq g(x) \leq h(x)$ for all $x$ in some common domain $A$. If
      \[
        \lim_{x \to c} f(x) = L = \lim_{x \to c} h(x)
      \]
      at some limit point $c \in A$, then
      \[
        \lim_{x \to c} g(x) = L.
      \]
    \end{theorem}

    \begin{subproof}
      Let $(x_{n})$ be an arbitrary sequence taken from $A$ that converges to
      $c$ with $x_{n} \neq c$ for any $n \geq 1$. Then, by the Order Limit
      Theorem, \thmref{thm:squeeze-theorem-sequences}, and the hypothesis, we
      have
      \[
        L = \lim_{n \to \infty} f(x_{n}) \leq \lim_{n \to \infty} g(x_{n}) \leq \lim_{n \to \infty} h(x_{n}) = L,
      \]
      therefore $\lim\limits_{n \to \infty} g(x_{n}) = L$. Since $(x_{n})$ was
      an arbitrary sequence tending to $c$, by the definition of a functional limit,
      we conclude:
      \[
        \lim_{x \to c} g(x) = L.
      \]
    \end{subproof}

    Returning to showing that $f'(0)$ exists, we can leverage the limit
    definition of the derivative to evaluate $f'(0)$:
    \[
      f'(0) = \lim_{h \to 0} \frac{f(0+h) - f(0)}{h} = \lim_{h \to 0} \frac{h^2 \sin \left( \frac{1}{h} \right) - 0}{h} = \lim_{h \to 0} h \sin \left( \frac{1}{h} \right).
    \]
    Since $\abs{\sin \left( \frac{1}{h} \right)} \leq 1$ for all $h \neq 0$,
    \[
      0 \leq \abs{h \sin \left( \frac{1}{h} \right)} \leq \abs{h}.
    \]
    As $h \to 0$, $\abs{h} \to 0$. Therefore, by \thmref{thm:squeeze-theorem-fn-limits},
    \[
      f'(0) = \lim_{h \to 0} h \sin\left(\frac{1}{h}\right) = 0.
    \]
    Hence, $f$ is differentiable at $x = 0$.

    Before we show that $f'$  is not continuous at $x = 0$, we will prove a very 
    very important theorem that will allow us to easily take the derivative
    of a composite function.

    \begin{theorem}[Chain Rule]
      \label{thm:chain-rule}
      Let $A, B \subseteq \R$. Suppose
      \begin{enumerate}[label=(\alph*)]
        \item $g : A \to B$ and $f : B \to \R$,
        \item $g$ is differentiable at $x \in A$ and $f$ is differentiable at $y = g(x) \in B$.
      \end{enumerate}
      Then $f \circ g : D \to \R$ is differentiable at $x$, and
      \[
        (f \circ g)'(x) = f'(g(x)) \cdot g'(x).
      \]
    \end{theorem}

    \begin{subproof}
      By differentiability of $f$ at $y$, there exists $\alpha(v) \to 0$ as $v \to 0$ with
      \[
        f(y+v) - f(y) = \bigl( f'(y) + \alpha(v) \bigr)\, v.
      \]
      Likewise, since $g$ is differentiable at $x$, there exists $\beta(h) \to 0$ as $h \to 0$ with
      \[
        g(x+h) - g(x) = \bigl( g'(x) + \beta(h) \bigr)\, h.
      \]
      Put $v = g(x+h) - g(x)$. Since $g$ is continuous at $x$, we have $v \to 0$ as $h \to 0$. Substituting,
      \begin{align*}
        f(g(x+h)) - f(g(x))
        &= \bigl( f'(y) + \alpha(v) \bigr)\, \bigl( g(x+h) - g(x) \bigr) \\
        &= \bigl( f'(y) + \alpha(v) \bigr)\, \bigl( g'(x) + \beta(h) \bigr)\, h.
      \end{align*}
      Dividing by $h$ gives
      \[
        \frac{f(g(x+h)) - f(g(x))}{h} = \bigl( f'(y) + \alpha(v) \bigr)\, \bigl( g'(x) + \beta(h) \bigr).
      \]
      Taking $h \to 0$ yields
      \[
        (f \circ g)'(x) = f'(y)\, g'(x) = f'(g(x))\, g'(x).
      \]
    \end{subproof}

    \begin{callout}[One-sided Derivatives]
      If $g(x)$ lies on the boundary of $E$, the same reasoning works with
      one-sided derivatives of $f$ provided $g(x+h)$ approaches $g(x)$ from
      within $E$. In that case, $(f \circ g)'(x)$ exists with
      $(f \circ g)'(x) = f'_\pm(g(x)) \cdot g'(x)$, where $f'_\pm$ is the
      appropriate one-sided derivative.
    \end{callout}

    By \thmref{thm:chain-rule}, we have
    \begin{equation*}
      f'(x) = 
      \begin{cases}
        2x \sin\left(\frac{1}{x}\right) - \cos\left(\frac{1}{x}\right) & \text{if } x \neq 0 \\
        0 & \text{if } x = 0.
      \end{cases}
    \end{equation*}
    Now, we construct two sequences, both of which converge to $0$:
    \[
      (a_{n}) = \frac{1}{2 \pi n}, \quad (b_{n}) = \frac{1}{\pi + 2 \pi n}.
    \]
    We have $f'(a_{n}) \to -1$ as $n \to \infty$ and $f'(b_{n}) \to 1$ as $n \to \infty$. 
    If $f'$ were continuous at $x = 0$, we would expect that the images (under $f'$) of every sequence
    (in the domain $(-\infty, 0) \cup (0, \infty)$) converging to $x =0$ would all converge to the same value (in $\R$).
    Having found a counterexample, we have shown that $f'$ cannot be continuous at $x = 0$.
  \end{proof}
\end{problem}

\begin{problem}
  Let $f$ and $g$ be differentiable functions. Prove the quotient rule:
    \begin{equation*}
      \left(\frac{f}{g}\right)' (x) = \frac{f'(x)g(x) - f(x)g'(x)}{[g(x)]^2}
    \end{equation*}
  provided $g(x) \neq 0$.

  \begin{proof}
    First, we generalize the result from \probref{prob:derivative-power-rule-positive-integers}.
    \begin{theorem}
      \label{thm:derivative-power-rule-integers}
      If $f(x) = x^{n}$ where $n \in \Z$, then $f'(x) = nx^{n-1}$.
    \end{theorem}

    \begin{subproof}
      Since \probref{prob:derivative-power-rule-positive-integers} covers the case when $n \in \N$
      and \probref{prob:derivative-constant} covers the case when $n = 0$, we just have to show that
      $f'(x) = nx^{n-1}$ when $n < 0$.

      Consider $n = -1$. Then, by the limit definition of the derivative, we have
      \[
        f'(x) = \lim_{h \to 0} \frac{(x + h)^{-1} - x^{-1}}{h} = \lim_{h \to 0} \frac{\frac{-h}{x(x + h)}}{h} = nx^{n-1} = -x^{-2}.
      \]
      Finally, using the result of the $n = -1$ case in conjunction with \thmref{thm:chain-rule} gives us
      $f'(x) = -nx^{n}$ for $n < -1$.
    \end{subproof}

    Notice that $\frac{f(x)}{g(x)} = f(x) \cdot g(x)^{-1}$.
    Let $h(x) = g(x)^{-1}$. By the \thmref{thm:prod-rule-deriv}, \thmref{thm:chain-rule}, and
    \thmref{thm:derivative-power-rule-integers}, we have:
    \begin{align*}
        \deriv{}{x} \left( f(x) \cdot {h(x)} \right) &= f'(x)h(x) + h'(x)f(x)\\
                                                    &= \frac{f'(x)}{g(x)} -\frac{g'(x) f(x)}{g(x)^{2}}\\
                                                    &= \frac{f'(x) g(x) - f(x) g'(x)} {g(x)^2}.
    \end{align*}
  \end{proof}

\end{problem}

\begin{problem}
  Suppose $f: A \to R$ has a local maximum at $x = a$ with $a$ being an
  interior limit point of $A$ and $f$ is differentiable at $x = a$.
  Prove that $f'(a) = 0$. (This is Fermat's theorem.)

  \begin{proof}
    Because $x = a$ is a local maximum, it follows that
    \[
      \exists \delta > 0.\, \forall x \in A. \abs{x - a} < \delta \implies f(x) \leq f(a).
    \] 
    Put $h = x - a$. Then $a + h \in A$ for $|h| < \delta$, and $f(a + h) \leq f(a)$ for such $h$.
    This inequality gives us $f(a + h) - f(a) \leq 0$ for all sufficiently small $h \neq 0$.
    Therefore, all sufficiently small $h \neq 0$ are described by two cases:
    \begin{itemize}
      \item When $h < 0$, we have $\dfrac{f(a + h) - f(a)}{h} \geq 0$.
      \item When $h > 0$, we have $\dfrac{f(a + h) - f(a)}{h} \leq 0$.
    \end{itemize}

    Since $f$ is differentiable at $a$, we know that 
    $f'(a) = \lim\limits_{h \to 0} \dfrac{f(a + h) - f(a)}{h}$ is well-defined and that
    \[
      0 \leq \lim\limits_{h \to 0^{-}} \dfrac{f(a + h) - f(a)}{h} = f'(a) = \lim_{h \to 0^{+}} \frac{f(a + h) - f(a)}{h} \leq 0,
    \]
    so $f'(a) = 0$.
  \end{proof}

\end{problem}
